<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/basic" xmlns="http://www.w3.org/1999/html">
<link rel="stylesheet" href="/css/board.css">
<link rel="stylesheet" href="/css/bootstrap.css">
<link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown-light.min.css"
        integrity="sha512-zb2pp+R+czM7GAemdSUQt6jFmr3qCo6ikvBgVU6F5GvwEDR0C2sefFiPEJ9QUpmAKdD5EqDUdNRtbOYnbF/eyQ=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
/>

<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<!-- include summernote css/js -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
<head>
    <script src="/js/top.js"></script>
</head>

<script src="/js/summer.js"></script>
<style>



</style>
<th:block layout:fragment="title">
    <title>상세 페이지</title>
</th:block>
<body>


<div class="top">

</div>
<div class="gap"></div>
<div class="grid-container">
    <div class="left">
        <div class="dropdown">
            <button class="dropbtn" type="button">
                 <span
                         class="dropbtn_icon">Tags</span>
            </button>
            <ul class="dropdown-content">
                <li><a href="/questions/tagList?tags=C">C</a></li>
                <li><a href="/questions/tagList?tags=Pawnable">Pawnable</a></li>
                <li><a href="/questions/tagList?tags=Reversing">Reversing</a></li>
                <li><a href="/questions/tagList?tags=Web">Web</a></li>
                <li><a href="/questions/tagList?tags=Crypto">Crypto</a></li>
            </ul>
        </div>
    </div>
    <div class="center">
        <th:block layout:fragment="content">
            <div class="container">
                <div>

                    <h1 th:text="${asks.title}"></h1>
                    <pre th:utext="${@commonUtil.markdown(asks.contents)}" class="markdown-body"></pre>
                    <p th:text="${asks.tags}"></p>
                    <p th:text="${asks.getWriter().getName()}" th:if="${asks.anonymous==false}"></p>
                    <div class="btn-group">
                        <form th:action="@{|/questions/edit/${asks.no}|}" th:method="get">

                            <button type="submit">수정</button>
                        </form>

                    <form th:action="@{|/questions/delete/${asks.no}|}" method="post">
                        <button type="submit">삭제</button>
                    </form>
                        </div>


                </div>
            </div>

        </th:block>

<br><br>



        <div>

            <ul calss="list-group">


            <span th:each="comment: ${comment}" th:if="${comment.selected == 'true'}" >
                <div id="comment_box" class="selected">

                    <div class="answer-between">
                   <pre th:utext="${@commonUtil.markdown(comment.reply)}" th:rows="4" class="markdown-body"></pre>
                         <p th:text="${comment.getWriter().getName()}"></p>
                     </div>
                </div>
                  <hr>
                <br><br>
            </span>



                    <span th:each="comment: ${comment}" th:if="${comment.depth==0}">


<div class="card">

                            <p th:text="${comment.getWriter().getName()}"> writer:</p>


                    <pre th:utext="${@commonUtil.markdown(comment.reply)}" th:rows="4" class="markdown-body"></pre>
                    <div class="btn-group">

                         <button type="button"
                                 th:onclick="'edit('+${comment.commentNo}+')'"
                                  th:id="'edit-button'+${comment.commentNo}">edit</button>

                     </form>
                    <form th:action="@{|/questions/comment/delete/${comment.commentNo}|}" th:if="${comment.getWriter().getNo()==1}">

                        <button type="submit" >delete</button>
                    </form>


                        <form th:action="@{|/questions/comment/selected/${comment.commentNo}|}" method="post" th:if="${comment.getWriter().getNo()==1}">
                                <button type="submit" >selected</button>
                        </form>
                         <button type="button"
                                 th:onclick="'reply('+${comment.commentNo}+')'"
                                  th:id="'reply-button'+${comment.commentNo}">reply</button>


                    </div>

                          <form th:action ="@{|/questions/comment/edit/${comment.commentNo}|}"
                                th:if="${comment.getWriter().getNo()==1}"
                                style="display: none"
                                th:id="'edit'+${comment.commentNo}" method="post">

                          <textarea name="reply" class="summernote"
                                    th:placeholder="${comment.reply}"></textarea>
                        <button type="submit" >modify</button>
                          </form>
                         <form th:action="@{|/questions/comment/${asks.no}/reply|}" method="post" th:id="'reply'+${comment.commentNo}" style="display: none" >
                           <textarea class="summernote" name="reply" ></textarea>
                            <input type="hidden" name="commentGroup" th:value="${comment.commentNo}"/>
                            <button type="submit" >reply</button>
                        </form>
</div>
                    <span th:each="reply: ${reply}" th:if="${reply.commentGroup == comment.commentNo}" class="reply">
<div class="card">
                    <div class="reply">


                        <pre th:utext="${@commonUtil.markdown(reply.reply)}" class="markdown-body"  th:rows="4"></pre>
                        <p th:text="${reply.getWriter().getName()}"> writer:</p>


                        <div class="btn-group">
                            <button type="button"
                                    th:onclick="'edit('+${reply.commentNo}+')'"
                                    th:id="'edit-button'+${reply.commentNo}">edit</button>

                            <!--delete comment -->


                             <form th:action="@{|/questions/comment/delete/${reply.commentNo}|}" th:if="${reply.getWriter().getNo()==1}">
                                 <!-- th:if="${reply.getMember().getNo()==SesstionLogin}"> -->
                                 <button type="submit" >delete</button>
                             </form>

                            <form th:action="@{|/questions/comment/selected/${reply.commentNo}|}" method="post" th:if="${reply.getWriter().getNo()==1}">
                                <button type="submit" >selected</button>
                            </form>
                              <button type="button"
                                      th:onclick="'reply('+${reply.commentNo}+')'"
                                      th:id="'reply-button'+${reply.commentNo}">reply</button>


                        </div>
                          <form th:action ="@{|/questions/comment/edit/${reply.commentNo}|}"
                                th:if="${comment.getWriter().getNo()==1}"
                                style="display: none"
                                th:id="'edit'+${reply.commentNo}"
                                method="post">

                        <textarea name="reply" class="summernote"
                                  th:placeholder="${reply.reply}"
                                  aria-labelledby="your-answer-header" tabindex="101" data-min-length=""></textarea>
                              <!--th:placeholder="${reply.reply}"-->
                            <button type="submit" >modify</button>
                         </form>

                        <form th:action="@{|/questions/comment/${asks.no}/reply|}" method="post" th:id="'reply'+${reply.commentNo}" style="display:none">
                              <textarea class="summernote" name="reply"></textarea>
                                <input type="hidden" name="commentGroup" th:value="${comment.commentNo}"/>
                                <button type="submit"  id="reply-submit">reply</button>
                        </form>
                    </div>
</div>
                     </span>
                      <hr>

            </span>


            </ul>

                <form th:action="@{|/questions/comment/${asks.no}|}" method="post" >
                    <div id="comment-write">
                <textarea id="summernote" name="reply" data-min-length=""></textarea>

                        <button type="submit">댓글 등록</button>
                    </div>
                </form>

            </div>


        </div>
    </div>
    <div class="right"></div>
</div>
<div class="bottom-nav">
    <div>
        <p> k.knock</p>
        <p> k.knock</p>
        <p> k.knock</p>
        <p> k.knock</p>
        <p> k.knock</p>
    </div>


</div>
</body>
<script>
//onclick
//temp는 정수


let temp=0;
function clear(commentNo){
    if(document.getElementById("reply"+temp)!=null)
    {
    document.getElementById("reply"+temp).style.display = "none";
    document.getElementById("reply-button"+temp).style.display = "block";
    document.getElementById("edit"+temp).style.display = "none";
    document.getElementById("edit-button"+temp).style.display = "block";}
    temp=commentNo;
}

    function reply(commentNo){

      clear(commentNo);


        document.getElementById("reply"+commentNo).style.display = "block";
        document.getElementById("reply-button"+commentNo).style.display = "none";
        document.getElementById("edit"+commentNo).style.display = "none";
        document.getElementById("edit-button"+commentNo).style.display = "block";
    }
    function edit(commentNo){
        clear(commentNo);

        document.getElementById("edit"+commentNo).style.display = "block";
        document.getElementById("edit-button"+commentNo).style.display = "none";
        document.getElementById("reply"+commentNo).style.display = "none";
        document.getElementById("reply-button"+commentNo).style.display = "block";

    }



</script>


</body>

</html>